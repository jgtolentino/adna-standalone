# Vercel Setup Checklist - One-Time Operator Tasks

This checklist ensures the repo is permanently linked to the existing `scout-dashboard` Vercel project.

## ‚úÖ Checklist

### 1. Local CLI: Link to Existing Project

Run from repo root:

```bash
cd /Users/tbwa/tbwa-agency-databank
vercel link
```

**When prompted:**
- ‚ùì **Set up and deploy?** ‚Üí YES
- ‚ùì **Which scope?** ‚Üí Select **"Jake Tolentino's projects"**
- ‚ùì **Link to existing project?** ‚Üí **YES**
- ‚ùì **What's your project's name?** ‚Üí Select **"scout-dashboard"**

**Expected result:**
- `.vercel/project.json` created with actual `orgId` and `projectId`
- `.vercel/.gitignore` created (auto-generated by Vercel CLI)

### 2. Local Git: Commit Vercel Configuration

```bash
# Verify .vercel/project.json was created
cat .vercel/project.json

# Should show something like:
# {
#   "orgId": "team_xxxxxxxxxxxxx",
#   "projectId": "prj_xxxxxxxxxxxxx"
# }

# Add to git
git add .vercel/project.json
git add vercel.json
git add .nvmrc
git add DEPLOYMENT_NOTES.md
git add VERCEL_SETUP_CHECKLIST.md
git add package.json

# Commit
git commit -m "chore: lock repo to canonical scout-dashboard Vercel project"

# Push to main
git push origin main
```

### 3. Vercel Dashboard: Verify Project Settings

Go to: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard/settings

**General ‚Üí Build & Development Settings:**
- ‚úÖ Framework Preset: **Next.js**
- ‚úÖ Root Directory: `apps/scout-dashboard`
- ‚úÖ Build Command: `npm run build` (or leave default)
- ‚úÖ Output Directory: `.next` (or leave default)
- ‚úÖ Install Command: `npm install` (or leave default)

**General ‚Üí Node.js Version:**
- ‚úÖ Select: **24.x**

**Git ‚Üí Production Branch:**
- ‚úÖ Ensure production branch is set to: `main`

### 4. Vercel Dashboard: Verify Environment Variables

Go to: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard/settings/environment-variables

**Required variables (all environments: Production, Preview, Development):**

| Variable Name | Value | Environments |
|---------------|-------|--------------|
| `NEXT_PUBLIC_SUPABASE_URL` | `https://ublqmilcjtpnflofprkr.supabase.co` | Production, Preview, Development |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | `eyJhbGci...` (from secure vault) | Production, Preview, Development |
| `NEXT_PUBLIC_MAPBOX_TOKEN` | `pk.eyJ1...` (from secure vault) | Production, Preview, Development |

**Verification:**
- Click each variable and confirm it's set for all three environments
- If missing, click "Add Variable" and paste values from secure vault

### 5. Vercel Dashboard: Verify Production Domain

Go to: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard/settings/domains

**Expected configuration:**
- ‚úÖ `scout-dashboard-xi.vercel.app` ‚Üí Assigned to Production branch
- ‚úÖ Domain shows as "Production" (not "Preview")

### 6. Trigger Test Deployment

After pushing the config commit from step 2:

```bash
# Option A: Wait for automatic deployment (triggered by git push)
# Monitor at: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard

# Option B: Manual deploy via CLI
vercel --prod
```

**Expected result:**
- Deployment starts automatically
- Build uses `apps/scout-dashboard` as root
- Next.js framework detected
- Node 24.x used for build
- Environment variables available during build
- Deployment succeeds and updates `scout-dashboard-xi.vercel.app`

### 7. Verify Production Site

Once deployment completes:

```bash
# Test production domain
curl -I https://scout-dashboard-xi.vercel.app/

# Should return:
# HTTP/2 200
# x-vercel-id: ...
# content-type: text/html; charset=utf-8
```

**Manual verification:**
1. Open: https://scout-dashboard-xi.vercel.app/
2. Check home page loads without errors
3. Navigate to: https://scout-dashboard-xi.vercel.app/geography
4. Verify Philippine choropleth map loads with Mapbox
5. Check browser console for errors (should be clean)

## üéØ Success Criteria

After completing all steps:

‚úÖ `.vercel/project.json` exists and is committed to git
‚úÖ Future `vercel` CLI commands auto-link to `scout-dashboard` project
‚úÖ Git pushes to `main` auto-deploy to production
‚úÖ Framework detection shows **Next.js** (not "No framework detected")
‚úÖ Build uses **Node 24.x** (not 18.x or 20.x)
‚úÖ All environment variables available during build
‚úÖ Production domain `scout-dashboard-xi.vercel.app` serves the app
‚úÖ No new Vercel projects created

## üìã Post-Setup Workflow

### Normal Deployment Workflow
```bash
# Make changes to apps/scout-dashboard/*
git add .
git commit -m "feat: your changes"
git push origin main

# Vercel automatically deploys to production
# Monitor: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard
```

### Preview Deployments
```bash
# Create feature branch
git checkout -b feature/new-feature

# Make changes
git add .
git commit -m "feat: experimental feature"
git push origin feature/new-feature

# Vercel automatically creates preview deployment
# Get preview URL from Vercel dashboard or CLI output
```

### Rollback to Previous Deployment
```bash
# Via dashboard:
# 1. Go to: https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard
# 2. Find previous successful deployment
# 3. Click "..." ‚Üí "Promote to Production"

# Via CLI:
vercel rollback
```

## üö® Troubleshooting

### CLI creates new project instead of linking
**Problem:** Running `vercel` creates a new project instead of using `scout-dashboard`

**Solution:**
```bash
# Delete the incorrect .vercel directory
rm -rf .vercel

# Re-run the link command
vercel link

# Select existing scout-dashboard project
# Commit the new .vercel/project.json
git add .vercel/project.json
git commit -m "fix: relink to correct Vercel project"
```

### Build fails: "No Next.js version detected"
**Problem:** Vercel can't find Next.js in the build

**Solution:**
1. Verify Root Directory = `apps/scout-dashboard` in Vercel dashboard
2. Check `apps/scout-dashboard/package.json` has `"next": "24.0.0"` dependency
3. Redeploy via `vercel --prod`

### Build fails: Missing environment variables
**Problem:** Build logs show "Missing NEXT_PUBLIC_SUPABASE_URL" or similar

**Solution:**
1. Go to Vercel dashboard ‚Üí Environment Variables
2. Add missing variables for all three environments
3. Redeploy (environment variable changes require redeploy)

## üìö Reference

- **Project Dashboard:** https://vercel.com/jake-tolentinos-projects-c0369c83/scout-dashboard
- **Deployment Notes:** [DEPLOYMENT_NOTES.md](./DEPLOYMENT_NOTES.md)
- **Vercel CLI Docs:** https://vercel.com/docs/cli
- **Monorepo Guide:** https://vercel.com/docs/monorepos/overview
